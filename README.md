# A Demo of Reliable Distributed System

[![Build Status](https://travis-ci.org/dwyl/esta.svg?branch=master)]()

## Protocol
 
 ### Input
 
Currently support input in client `var=value`, an `id` will be automatically generated by protocol.

### Communication Between Server and Client

#### Request

`val=value` will be packed in the following form

```
client_id#server_id#request_id#var#value
``` 

and then send to server. 

Server will unpack it to `var` and `value` and store it in database.

#### Respond

A Respond will be send from server to client indicating that server has received msg. The respond will look like

```$xslt
client_id#server_id#request_id#data_in_server_database
```

### Communication between LFD and GFD

LFD and GFD are communicate in a similar protocol, where the msg looks like

```$xslt
LFD_id#operation#server_id
```
`operation` could be either `add` or `delete`, indicating the status change of a server from dead to alive or alive to dead.

## Database

Currently a naive `hashmap<String, String>`.

## Local Fault Detector and Global Fault Detector

### LFD (Local Fault Detector)

LFD will keep pinging server to determine whether it is alive. When server is dead, it will report to the GFD that server is no longer available, when server is back online, it will also report to the GFD.

### GFD (Global Fault Detector)

The GFD will maintain a database (currently the a hash set) about the availability of servers. Message from LFD will be handled to determine whether a server is available anymore.

## Active Replication

### Server

Client connect to all the server, server update when receive client.

### Recovery

new server online ---> LFD detect ---> GFD receive membership ---> RM receive ---> RM add to mem ---> RM send msg to one server to send chkpmsg --> recovery server recover

### Duplicate Detection

Client receive; 

TBC

## RM

functions

maintain/update membership
desinating new primary in passive mode
updating newly added server in active mode (ask one server to send chkpt msg to new server)

## Passive Replication

### Server/ Checkpt


### Duplicate Detection

Same to active. Client receive; 

### When primary server down

primary down --> LFD --> GFD --> RM --> desginate new primary --> backup server -> new primary

### Recovery

new server (back up server) --> will be updated when received chkpoint msg

## Usage

TODO: how to launch each program

### Server

`java Server <Server id> <port number> (<primary or backup or recover>) (option: p for primary, b for back up))`

i.e.

`java Server 0 8888 p` stands for launching server 0 in passive mode as primary listening port 8888.

`java Server 0 8888` stands for launching server 0 in active mode listening port 8888.

`java Server 0 8888 r` stands for launching server 0 as recovery in active mode listening port 8888. (In passive mode, launch a backup server 0 directly).

### LFD

### GFD

### Replica Manager

### Client
